<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Herrera Motors</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white text-black">
    <nav class="flex items-center justify-between px-6 py-4 border-b">
      <div class="text-xl font-semibold tracking-widest">HERRERA MOTORS</div>
      <div class="hidden md:flex gap-8 text-sm">
        <a href="#" class="hover:underline">Sobre</a>
        <a href="#" class="hover:underline">Experiência AG</a>
        <a href="#" class="hover:underline">Veículos</a>
        <a href="#" class="hover:underline">Blog</a>
        <a href="#" class="hover:underline">Universo AG</a>
        <a href="#" class="hover:underline">Contato</a>
      </div>
      <div class="flex gap-4">
        <button aria-label="Buscar">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" />
          </svg>
        </button>
        <button aria-label="Menu">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" />
          </svg>
        </button>
      </div>
    </nav>

    <section class="flex flex-col items-center px-4 py-8">
      <h2 class="text-xl font-semibold mb-6">Encontre seu próximo veículo</h2>
      <div class="w-full max-w-5xl flex flex-col md:flex-row justify-center gap-4">
        <select id="marcaSelect" class="border-b-2 border-orange-500 px-2 py-1 w-full md:w-1/3">
          <option value="">Selecione a marca</option>
        </select>
        <select id="modeloSelect" class="border-b-2 border-orange-500 px-2 py-1 w-full md:w-1/3">
          <option value="">Selecione o modelo</option>
        </select>
        <button id="btnBuscar" class="bg-orange-600 text-white px-6 py-2 font-bold rounded-r-md hover:bg-orange-700">
          BUSCAR
        </button>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const marcaSelect = document.getElementById("marcaSelect");
        const modeloSelect = document.getElementById("modeloSelect");

        const res = await fetch("https://roanjrdmydpvbpryiegg.supabase.co/rest/v1/ESTOQUE?select=*&apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvYW5qcmRteWRwdmJwcnlpZWdnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY4MDgxNDAsImV4cCI6MjA2MjM4NDE0MH0.FW-W8u-oWVsTy70dYFIdfMNsSEwjsndBlBo_ombAuNU");
        const estoque = await res.json();

        if (!estoque.length) {
          alert("Nenhum veículo encontrado.");
          return;
        }

        const marcasUnicas = [...new Set(estoque.map((v) => v.modelo.split(" ")[0]))];
        marcasUnicas.sort().forEach((marca) => {
          const opt = document.createElement("option");
          opt.value = marca;
          opt.textContent = marca;
          marcaSelect.appendChild(opt);
        });

        marcaSelect.addEventListener("change", () => {
          const marca = marcaSelect.value;
          modeloSelect.innerHTML = '<option value="">Selecione o modelo</option>';
          estoque
            .filter((v) => v.modelo.startsWith(marca))
            .forEach((v) => {
              const opt = document.createElement("option");
              opt.value = v.modelo;
              opt.textContent = v.modelo;
              modeloSelect.appendChild(opt);
            });
        });

        document.getElementById("btnBuscar").addEventListener("click", () => {
          const modelo = modeloSelect.value;
          if (modelo) window.location.href = `/veiculo.html?modelo=${encodeURIComponent(modelo)}`;
        });
      });
    </script>
  </body>
</html>
